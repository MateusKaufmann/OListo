<%# Partial: Resolver Estoque (Listo Scan - Tinder por categoria) %>
<div id="side-scan" style="width: 50%; flex-shrink: 0; padding: 0 15px; overflow-y: auto; display: none;">

  <div style="display: flex; justify-content: space-between; align-items: center; height: 80px; padding: 15px 5px;">
    <div>
      <h2 class="page-title" style="margin:0; font-size: 1.5rem; color: var(--dynamic-text);">Resolver Estoque</h2>
      <p class="card-subtitle">Ajuste fino categoria por categoria</p>
    </div>
    <button onclick="salvarTudo()" class="card-btn" style="background: var(--emerald); color: white; border: none; padding: 10px 25px;">Finalizar Tudo</button>
  </div>

  <section class="content-grid">

    <% 
      const configTinder = [
        { id: 'cozinha', titulo: 'Cozinha', cat: 'Alimentos', cor: 'linear-gradient(135deg, #ff9966, #ff5e62)' },
        { id: 'higiene', titulo: 'Higiene', cat: 'Higiene', cor: 'linear-gradient(135deg, #00d2ff, #3a7bd5)' },
        { id: 'limpeza', titulo: 'Limpeza', cat: 'Limpeza', cor: 'linear-gradient(135deg, #43e97b, #38f9d7)' },
        { id: 'geral', titulo: 'Gerais', cat: 'Outro', cor: 'linear-gradient(135deg, #667eea, #764ba2)' }
      ];
      configTinder.forEach(tinder => {
        const itens = data.estoque.filter(i => {
          return (tinder.cat === 'Outro') ? 
            (i.categoria === 'Outro' || !['Alimentos','Higiene','Limpeza'].includes(i.categoria)) : 
            (i.categoria === tinder.cat);
        });
    %>

    <div class="glass-card tinder-card" id="tinder-<%= tinder.id %>" style="display: flex; flex-direction: column; overflow: hidden; position: relative; padding: 15px;">

      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <span style="font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--dynamic-subtext);"><%= tinder.titulo %></span>
        <span class="tinder-counter" style="font-size: 0.7rem; opacity: 0.6;">1 / <%= itens.length %></span>
      </div>

      <div class="tinder-track" style="flex: 1; display: flex; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); width: <%= itens.length * 100 %>%;">

        <% itens.forEach((item, index) => { 
          let svgIcon = ''; 
          switch(item.categoria) {
            case 'Higiene': svgIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /></svg>'; break;
            case 'Alimentos': svgIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 7c-4 0-7 3-7 8a7 7 0 0 0 14 0c0-5-3-8-7-8z" /><path d="M12 7c0-2 1-4 3-5" /></svg>'; break;
            case 'Limpeza': svgIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 3h6M10 3v4M14 7H8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" /></svg>'; break;
            default: svgIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /></svg>';
          }
        %>
        <div class="tinder-item" style="width: <%= 100 / itens.length %>%; padding: 10px; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center;">

          <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; width: 100%; padding: 0 15px;">
            <div class="activity-avatar" style="background: <%= tinder.cor %>; min-width: 70px; height: 70px; border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0; box-shadow: 0 8px 20px rgba(0,0,0,0.1);">
              <div style="width: 35px;"><%- svgIcon %></div>
            </div>
            <div style="flex-grow: 1; text-align: left;">
              <h3 style="margin: 0; font-size: 1.2rem; color: var(--dynamic-text);"><%= item.nome %></h3>
              <p style="font-size: 0.75rem; color: var(--dynamic-subtext); margin: 2px 0 8px 0;">Meta: <%= item.quantidade_ideal %></p>
              <div class="progress-bar" style="width: 100%; height: 8px; background: rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden;">
                <div id="bar-<%= item.id %>" data-ideal="<%= item.quantidade_ideal %>" style="width: <%= Math.min(100, (item.estoqueEstimado / item.quantidade_ideal) * 100) %>%; height: 100%; background: <%= tinder.cor %>; transition: width 0.3s ease;"></div>
              </div>
            </div>
          </div>

          <div class="pill-input-group" style="display: flex; align-items: center; gap: 25px; background: rgba(0,0,0,0.03); padding: 12px 25px; border-radius: 50px; border: 1px solid var(--glass-border);">
            <button onclick="updateTinderQty('<%= item.id %>', -1)" style="border: none; background: none; font-size: 1.8rem; cursor: pointer; color: var(--primary); font-weight: bold;">-</button>
            <span id="val-<%= item.id %>" class="qty-val" style="font-size: 2.2rem; font-weight: 800; min-width: 60px; color: var(--dynamic-text);"><%= Math.round(item.estoqueEstimado) %></span>
            <button onclick="updateTinderQty('<%= item.id %>', 1)" style="border: none; background: none; font-size: 1.8rem; cursor: pointer; color: var(--primary); font-weight: bold;">+</button>
          </div>

          <p style="font-size: 0.7rem; color: var(--dynamic-subtext); margin-top: 15px;">Ãšltima compra: <%= item.data_ultima_compra || 'N/A' %></p>
        </div>
        <% }) %>
      </div>

      <div style="display: flex; justify-content: space-between; margin-top: 10px;">
        <button onclick="moveTinder('<%= tinder.id %>', -1)" style="background: none; border: none; cursor: pointer; opacity: 0.4;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <button onclick="moveTinder('<%= tinder.id %>', 1)" style="background: none; border: none; cursor: pointer; opacity: 0.4;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6" />
          </svg>
        </button>
      </div>
    </div>
    <% }) %>

  </section>
</div>
